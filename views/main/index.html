<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto</title>
    <link rel="stylesheet" href="./main/main.css">
    
</head>
<body>
    <div class="wrap">
        <div class="header_wrap">
            <div class="header">
                <div class="logo">
                    <img src="./main/로고.png" alt="">
                </div>
                <section class="gnb">
                    <ul class="gnb_con">
                        <li><a href="#">간편구매</a></li>
                        <li><a href="#">거래소</a></li>
                        <li><a href="#">프로차트</a></li>
                        <li><a href="#">코인정보</a></li>
                    </ul>
                </section>
                <div class="my_area">
                    {% if isLogin %}
                    <button>마이페이지</button>
                    <button onclick="location.href='/user/logout'">로그아웃</button>
                    {% else %}
                    <button onclick="location.href='/user/signup/agree'">회원가입</button>
                    <button onclick="location.href='/user'">로그인</button>
                    {% endif %}
                </div>
            </div>
        </div>
        <div id="divide"></div>
        <section class="main">
            <div class="main_con">
                <div class="coin_chart">
                    <h2>코인 차트</h2>
                    <img src="./main/비트코인차트.png" alt="">
                </div>
                <div class="coin_list">
                    <h2>코인 리스트</h2>
                    <ul>
                    
                    </ul>
                </div>
            </div>
            <div class="main_con2">
                <div class="Elon_twiter">
                    <h2>Elon Musk Twitter</h2>
                    <a class="twitter-timeline" href="https://twitter.com/elonmusk?ref_src=twsrc%5Etfw"></a>
                </div>
                <div class="coin_issue">
                    <h2>Coin issue</h2>
                {% for item in issue %}               
                <ul>
                    <li>{{item.title}}</li>
                </ul>
                {% endfor %}
                </div>
            </div>
            <div class="main_con3">
                <div class="chat">
                    <iframe src="http://localhost:3000/" width=100% height=500 scrolling="no" frameborder=0 margininheight=0 margininwidth=0 ailgn="top"></iframe>
                </div>
            </div>
        </section>
        <footer class="footer">
            <div class="footer_con">
                
            </div>
        </footer>
    </div>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../coin_issue.js"></script>
    <script type="text/javascript">

        const timer = ms => new Promise(res => setTimeout(res,ms));
        
        // apii=document.querySelector('');
        async function callbackhell(){
            const url2 = 'http://localhost:3001/info'
            const options2 = {method: 'POST', headers: {Accept: 'application/json'}};
           
            let fet = await fetch(url2, options2)
            .then(res=>{
                return res.json()
            })
            .then(json=>{
                const result = json['coin']
                console.log(result);
               
                let list = document.querySelector('.coin_list > ul');
                let coinList = document.querySelectorAll('.coin_list > ul > li');
                for(var i=0; i<result.length;i++){
                    if(coinList[0]==undefined){
                        
                        let li = document.createElement('li');

                        let p = document.createElement('p');
                        p.innerHTML = result[i][0].market;
                        console.log(result[i][0].change);
                        let h5 = document.createElement('h5');
                        let span = document.createElement('span');
                        span.innerHTML = result[i][0].trade_price.toLocaleString('ko-KR');

                        var per = `${Math.round(result[i][0].change_rate * 10000) / 100}%`;
                        if(result[i][0].change == "FALL"){
                            h5.innerHTML = `-${per}`;
                            h5.style.color = 'blue';
                            span.style.color = 'blue';
                        }else if(result[i][0].change == "RISE"){
                            h5.innerHTML = per;
                            h5.style.color = 'red';
                            span.style.color = 'blue';
                        }else{
                            h5.innerHTML = per;
                        }

                        
                        
                        
                        console.log(result[i][0].change)
                        
                        
                        li.appendChild(p);
                        li.appendChild(span);
                        li.appendChild(h5);
                        list.appendChild(li);
                        
                    }
                    
                }
            })
            .catch(()=>{
                timer(2000);
                location.reload(true);
                location.href = location.href;
                history.go(0);
            })

            
            
        }
        
        
        callbackhell();
        setInterval(callbackhell,70000);
        


    </script>
</body>
</html>